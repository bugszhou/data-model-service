!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("lodash.isobject"),require("lodash.isempty"),require("lodash.isarray"),require("lodash.mapvalues"),require("lodash.get"),require("type-of")):"function"==typeof define&&define.amd?define(["exports","lodash.isobject","lodash.isempty","lodash.isarray","lodash.mapvalues","lodash.get","type-of"],t):(e=e||self,function(){var r=e["data-model-service"],n=e["data-model-service"]={};t(n,e.isObject,e.isEmpty,e.isArray,e.mapValues,e.getVal,e.typeOf),n.noConflict=function(){return e["data-model-service"]=r,n}}())}(this,function(e,t,r,n,o,a,i){"use strict";function s(e,t){return e(t={exports:{}},t.exports),t.exports}t=t&&t.hasOwnProperty("default")?t.default:t,r=r&&r.hasOwnProperty("default")?r.default:r,n=n&&n.hasOwnProperty("default")?n.default:n,o=o&&o.hasOwnProperty("default")?o.default:o,a=a&&a.hasOwnProperty("default")?a.default:a,i=i&&i.hasOwnProperty("default")?i.default:i;var u=s(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(n){return"function"==typeof Symbol&&"symbol"===t(Symbol.iterator)?e.exports=r=function(e){return t(e)}:e.exports=r=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":t(e)},r(n)}e.exports=r});var c=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var f=function(e,t,r){return t&&l(e.prototype,t),r&&l(e,r),e};var p=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e};var d=function(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?p(e):t},y=s(function(e){function t(r){return e.exports=t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},t(r)}e.exports=t}),v=s(function(e){function t(r,n){return e.exports=t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},t(r,n)}e.exports=t});var h=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)};var m=function(e,t){var r=t.get(e);if(!r)throw new TypeError("attempted to get private field on non-instance");return r.get?r.get.call(e):r.value};var b=function(e,t,r){var n=t.get(e);if(!n)throw new TypeError("attempted to set private field on non-instance");if(n.set)n.set.call(e,r);else{if(!n.writable)throw new TypeError("attempted to set read only private field");n.value=r}return r};var g=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},w=function(){function e(){c(this,e),g(this,"parsedData",{})}return f(e,[{key:"getModel",value:function(){return{}}},{key:"parse",value:function(){return{}}},{key:"traverse",value:function(){return{}}}]),e}();var O=function(e){if(Array.isArray(e))return e};var P=function(e,t){var r=[],n=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw a}}return r};var x=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")};var j=function(e,t){return O(e)||P(e,t)||x()};function k(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.isPass,r=e.msg,n=void 0===r?"":r,o=e.val,a=void 0===o?"":o,i=e.expectedType,s=void 0===i?"":i,c=e.keyName,l=void 0===c?"":c,f=e.oneOf,p=void 0===f?[]:f;return{isPass:void 0!==t&&t,reason:{msg:n,property:l,value:a||"",type:u(a),expected:{type:s,oneOf:p}}}}function q(e,o){if(!e||!o)return k({isPass:!1,msg:"valid-data require 2 args(data & schema)"});if(!t(e))return k({isPass:!1,msg:"args[0] require object"});if(!t(o)||n(o))return k({isPass:!1,msg:"args[1](schema) require object"});if(r(o))return k({isPass:!0,msg:"args[1](schema) is empty"});if(n(e))return k({isPass:!1,msg:"args[0](data) require object"});var a=function(e,t){var r=[],o=[];return Object.entries(t).some(function(t){var a=j(t,2),s=a[0],u=a[1],c=e[s];if("boolean"===i(u.required)&&!u.required)return o.push(k({isPass:!0,val:c,expectedType:u.type,keyName:s,msg:""})),!1;if("undefined"===i(c))return r.push(k({isPass:!1,val:"undefined",expectedType:u.type,keyName:s,msg:"Lose ".concat(s)})),!0;if(i(c)!==u.type)return r.push(k({isPass:!1,val:c,expectedType:u.type,keyName:s,msg:"type error"})),!0;var l=u.oneOf;return n(l)&&0<l.length?l.includes(c)?(o.push(k({isPass:!0,val:c,expectedType:u.type,keyName:s,msg:""})),!1):(r.push(k({isPass:!1,val:c,expectedType:u.type,keyName:s,msg:"oneOf not found ".concat(c),oneOf:l})),!0):(o.push(k({isPass:!0,val:c,expectedType:u.type,keyName:s,msg:""})),!1)}),{errors:r,passData:o}}(e,o).errors;return 0<a.length?a.shift():{isPass:!0,reason:{msg:"",property:"",value:"",type:"",expected:{type:"",oneOf:[]}}}}var S={type:{type:"string",description:"类型",oneOf:["string","number","integer","boolean","object","array","null"],required:!0},description:{type:"string",description:"描述",required:!1},from:{type:"string",description:"数据来源",required:!0},properties:{type:"object",description:"属性",required:!1},default:{type:"function",description:"默认值",required:!1},required:{type:"boolean",description:"是否必传",required:!1}};function T(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}var E=function(e){function o(e){var t;return c(this,o),t=d(this,y(o).call(this)),I.add(p(t)),V.add(p(t)),C.add(p(t)),D.add(p(t)),A.add(p(t)),M.add(p(t)),N.add(p(t)),W.add(p(t)),_.set(p(t),{writable:!0,value:{}}),T(p(t),W,L).call(p(t),e),t}return h(o,w),f(o,[{key:"getModel",value:function(){return m(this,_)}},{key:"parse",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return t(e)?r(e)&&!n(e)?T(this,I,J).call(this):n(e)?T(this,D,F).call(this,e):T(this,M,z).call(this,e):(console.error("data require object"),T(this,I,J).call(this))}}]),o}(),_=new WeakMap,W=new WeakSet,N=new WeakSet,M=new WeakSet,A=new WeakSet,D=new WeakSet,C=new WeakSet,V=new WeakSet,I=new WeakSet,L=function(e){var r=function(e,r){if(!t(e))return{isPass:!1,reason:{msg:"args[0] require object",property:"",value:"",type:"string",expected:{type:"",oneOf:[]}}};var n=null;return Object.keys(e).some(function(t){var o=q(e[t],r);return!o.isPass&&(n=o,!0)}),n||{isPass:!0,reason:{msg:"",property:"",value:"",type:"",expected:{type:"",oneOf:[]}}}}(e,S);if(!r.isPass)throw new Error(r);T(this,N,R).call(this,e)},R=function(e){b(this,_,e)},z=function(e){var t=this;return o(m(this,_),function(r){var n=T(t,A,B).call(t,a(e,r.from,T(t,C,G).call(t,r.default)),r);return T(t,V,H).call(t,n,r.type)})},B=function(e,t){return"object"!==t.type&&"array"!==t.type||!t.properties?e:K(t.properties).parse(e)},F=function(e){var t=this;return void 0===e[0]?e:["number","boolean","string"].includes(u(e[0]))?e:e.map(function(e){return T(t,M,z).call(t,e)})},G=function(e){return"function"==typeof e?e():null==e?"":e},H=function(e,t){return u(e)===t?e:"number"===t?+e:"string"===t?"".concat(e):"boolean"===t?!!e:e},J=function(){var e=this;return o(m(this,_),function(t){return T(e,C,G).call(e,t.default)})};function K(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new E(e)}e.createDataModel=K,e.default=E,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=data-model-service.common.js.map
